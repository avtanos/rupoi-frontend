<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>РУПИО - Система управления протезированием</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --border: #bdc3c7;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light);
            color: var(--dark);
        }
        
        .app {
            display: grid;
            grid-template-columns: 250px 1fr;
            grid-template-rows: 60px 1fr;
            grid-template-areas: "sidebar header" "sidebar main";
            height: 100vh;
        }
        
        .header {
            grid-area: header;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: var(--shadow);
        }
        
        .sidebar {
            grid-area: sidebar;
            background: white;
            border-right: 1px solid var(--border);
            padding: 20px 0;
            overflow-y: auto;
        }
        
        .main {
            grid-area: main;
            padding: 20px;
            overflow-y: auto;
        }
        
        .logo {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 30px;
            padding: 0 20px;
            color: var(--primary);
        }
        
        .nav-group {
            margin-bottom: 20px;
        }
        
        .nav-title {
            font-size: 12px;
            text-transform: uppercase;
            color: #7f8c8d;
            padding: 0 20px 10px;
            font-weight: 600;
        }
        
        .nav-item {
            display: block;
            padding: 12px 20px;
            color: var(--dark);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            cursor: pointer;
        }
        
        .nav-item:hover, .nav-item.active {
            background: #f8f9fa;
            border-left-color: var(--secondary);
            color: var(--secondary);
        }
        
        .view {
            display: none;
        }
        
        .view.active {
            display: block;
        }
        
        .page-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .table tr:hover {
            background: #f8f9fa;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .col {
            flex: 1;
        }
        
        .col-2 {
            flex: 0 0 50%;
        }
        
        .col-3 {
            flex: 0 0 33.333%;
        }
        
        .col-4 {
            flex: 0 0 25%;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-new {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .status-in-progress {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .status-ready {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .status-issued {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .breadcrumb {
            margin-bottom: 20px;
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .breadcrumb a {
            color: var(--secondary);
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            text-align: center;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: var(--light);
        }
        
        .login-card {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            width: 400px;
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary);
        }
        
        .role-badge {
            display: inline-block;
            padding: 4px 8px;
            background: var(--secondary);
            color: white;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 4px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            display: none;
        }
        
        .notification.success {
            background: var(--success);
        }
        
        .notification.error {
            background: var(--danger);
        }
        
        .notification.warning {
            background: var(--warning);
        }
        
        @media (max-width: 768px) {
            .app {
                grid-template-columns: 1fr;
                grid-template-areas: "header" "main";
            }
            
            .sidebar {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Экран входа -->
        <div id="login-screen" class="login-container">
            <div class="login-card">
                <h2 class="login-title">Вход в систему РУПИО</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="username">Логин</label>
                        <input type="text" id="username" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Пароль</label>
                        <input type="password" id="password" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Войти</button>
                </form>
            </div>
        </div>
        
        <!-- Основное приложение -->
        <div id="main-app" class="app" style="display: none;">
            <header class="header">
                <div>
                    <h1>РУПИО</h1>
                    <span id="breadcrumb">/ Главная</span>
                </div>
                <div>
                    <span id="user-info">Администратор</span>
                    <button class="btn btn-danger" onclick="logout()" style="margin-left: 10px;">Выход</button>
                </div>
            </header>
            
            <nav class="sidebar">
                <div class="logo">РУПИО</div>
                
                <div class="nav-group">
                    <div class="nav-title">Основные модули</div>
                    <a href="#" class="nav-item active" data-view="dashboard">Главная</a>
                    <a href="#" class="nav-item" data-view="cart-list">Картотека пациентов</a>
                    <a href="#" class="nav-item" data-view="order-list">Управление заказами</a>
                    <a href="#" class="nav-item" data-view="medical-dept">Медицинский отдел</a>
                    <a href="#" class="nav-item" data-view="warehouse">Склад</a>
                    <a href="#" class="nav-item" data-view="reports">Отчетность</a>
                </div>
                
                <div class="nav-group">
                    <div class="nav-title">Администрирование</div>
                    <a href="#" class="nav-item" data-view="users">Пользователи</a>
                    <a href="#" class="nav-item" data-view="employees">Сотрудники</a>
                    <a href="#" class="nav-item" data-view="dictionaries">Справочники</a>
                </div>
            </nav>
            
            <main class="main">
                <!-- Главная страница -->
                <div id="dashboard" class="view active">
                    <div class="page-title">Главная панель</div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="total-patients">1,247</div>
                            <div class="stat-label">Всего пациентов</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-orders">412</div>
                            <div class="stat-label">Всего заказов</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="active-orders">156</div>
                            <div class="stat-label">В работе</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="ready-orders">34</div>
                            <div class="stat-label">Готово к выдаче</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Последние заказы</h3>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>№ заказа</th>
                                    <th>Пациент</th>
                                    <th>Тип</th>
                                    <th>Статус</th>
                                    <th>Дата</th>
                                </tr>
                            </thead>
                            <tbody id="recent-orders">
                                <tr>
                                    <td>ORD-2025-0156</td>
                                    <td>Иванов И.И.</td>
                                    <td>Протез</td>
                                    <td><span class="status-badge status-in-progress">В работе</span></td>
                                    <td>01.08.2025</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Картотека пациентов -->
                <div id="cart-list" class="view">
                    <div class="page-title">Картотека пациентов</div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">1,247</div>
                            <div class="stat-label">Всего пациентов</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">892</div>
                            <div class="stat-label">Активных</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">156</div>
                            <div class="stat-label">Снятых с учета</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">199</div>
                            <div class="stat-label">Несостоящих на учете</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>Реестр пациентов</h3>
                            <button class="btn btn-primary" onclick="showView('cart-create')">+ Новый пациент</button>
                        </div>
                        
                        <div class="row">
                            <div class="col">
                                <input type="text" class="form-control" placeholder="Поиск по ФИО, ПИН, номеру карточки...">
                            </div>
                            <div class="col-2">
                                <select class="form-control">
                                    <option>Все группы инвалидности</option>
                                    <option>I группа</option>
                                    <option>II группа</option>
                                    <option>III группа</option>
                                    <option>Ребенок-инвалид</option>
                                </select>
                            </div>
                            <div class="col-2">
                                <button class="btn btn-primary">Поиск</button>
                            </div>
                        </div>
                        
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>№ карточки</th>
                                    <th>ФИО</th>
                                    <th>Дата рождения</th>
                                    <th>ПИН</th>
                                    <th>Группа</th>
                                    <th>Телефон</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>2025-0001</td>
                                    <td>Иванов Иван Иванович</td>
                                    <td>12.03.1980</td>
                                    <td>1230****4567</td>
                                    <td>II группа</td>
                                    <td>+996 555 123 456</td>
                                    <td><span class="status-badge status-ready">Активен</span></td>
                                    <td>
                                        <button class="btn btn-primary" onclick="showView('cart-info')">Просмотр</button>
                                        <button class="btn btn-warning" onclick="showView('cart-edit')">Редактировать</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Управление заказами -->
                <div id="order-list" class="view">
                    <div class="page-title">Управление заказами</div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">412</div>
                            <div class="stat-label">Всего заказов</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">156</div>
                            <div class="stat-label">В работе</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">34</div>
                            <div class="stat-label">Готово к выдаче</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">11</div>
                            <div class="stat-label">Просрочено</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>Реестр заказов</h3>
                            <button class="btn btn-primary" onclick="showView('order-create')">+ Новый заказ</button>
                        </div>
                        
                        <div class="row">
                            <div class="col-2">
                                <select class="form-control">
                                    <option>Все типы</option>
                                    <option>Протезы</option>
                                    <option>Обувь</option>
                                    <option>Ортопедические изделия</option>
                                    <option>Ремонт</option>
                                </select>
                            </div>
                            <div class="col-2">
                                <select class="form-control">
                                    <option>Все статусы</option>
                                    <option>Новый</option>
                                    <option>В производстве</option>
                                    <option>На примерке</option>
                                    <option>На складе</option>
                                    <option>Выдан</option>
                                </select>
                            </div>
                            <div class="col">
                                <input type="text" class="form-control" placeholder="Поиск по номеру заказа, ФИО...">
                            </div>
                            <div class="col-2">
                                <button class="btn btn-primary">Поиск</button>
                            </div>
                        </div>
                        
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>№ заказа</th>
                                    <th>Пациент</th>
                                    <th>Тип</th>
                                    <th>Изделие</th>
                                    <th>Статус</th>
                                    <th>Дата создания</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ORD-2025-0156</td>
                                    <td>Иванов И.И.</td>
                                    <td>Протез</td>
                                    <td>Протез бедра</td>
                                    <td><span class="status-badge status-in-progress">В работе</span></td>
                                    <td>01.08.2025</td>
                                    <td>
                                        <button class="btn btn-primary" onclick="showView('order-info')">Просмотр</button>
                                        <button class="btn btn-warning" onclick="showView('order-edit')">Редактировать</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Медицинский отдел -->
                <div id="medical-dept" class="view">
                    <div class="page-title">Медицинский отдел</div>
                    
                    <div class="card">
                        <h3>Направленные пациенты</h3>
                        <p>Список пациентов, направленных в медицинский отдел для утверждения заказов.</p>
                    </div>
                </div>
                
                <!-- Склад -->
                <div id="warehouse" class="view">
                    <div class="page-title">Склад</div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">1,247</div>
                            <div class="stat-label">Всего позиций</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">892</div>
                            <div class="stat-label">В наличии</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">34</div>
                            <div class="stat-label">Критический запас</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">156</div>
                            <div class="stat-label">Списано</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Складские запасы</h3>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Артикул</th>
                                    <th>Наименование</th>
                                    <th>Категория</th>
                                    <th>Количество</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>PROT-001</td>
                                    <td>Протез бедра титановый</td>
                                    <td>Протезы</td>
                                    <td>15 шт.</td>
                                    <td><span class="status-badge status-ready">В наличии</span></td>
                                    <td>
                                        <button class="btn btn-primary">Просмотр</button>
                                        <button class="btn btn-warning">Редактировать</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Отчетность -->
                <div id="reports" class="view">
                    <div class="page-title">Отчетность</div>
                    
                    <div class="card">
                        <h3>Доступные отчеты</h3>
                        <div class="row">
                            <div class="col-2">
                                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="generateReport('lovz')">Отчет по ЛОВЗ</button>
                            </div>
                            <div class="col-2">
                                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;" onclick="generateReport('manufactured')">Отчет по изготовленным изделиям</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Пользователи -->
                <div id="users" class="view">
                    <div class="page-title">Управление пользователями</div>
                    
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>Пользователи системы</h3>
                            <button class="btn btn-primary">+ Новый пользователь</button>
                        </div>
                        
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Логин</th>
                                    <th>ФИО</th>
                                    <th>Роль</th>
                                    <th>Отдел</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>admin</td>
                                    <td>Администратор Системы</td>
                                    <td><span class="role-badge">Администратор</span></td>
                                    <td>IT</td>
                                    <td><span class="status-badge status-ready">Активен</span></td>
                                    <td>
                                        <button class="btn btn-primary">Просмотр</button>
                                        <button class="btn btn-warning">Редактировать</button>
                                        <button class="btn btn-danger">Заблокировать</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Сотрудники -->
                <div id="employees" class="view">
                    <div class="page-title">Управление сотрудниками</div>
                    
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>Сотрудники организации</h3>
                            <button class="btn btn-primary">+ Новый сотрудник</button>
                        </div>
                        
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ФИО</th>
                                    <th>Должность</th>
                                    <th>Отдел</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Петров Петр Петрович</td>
                                    <td>Мастер-протезист</td>
                                    <td>Производство</td>
                                    <td><span class="status-badge status-ready">Активен</span></td>
                                    <td>
                                        <button class="btn btn-primary">Просмотр</button>
                                        <button class="btn btn-warning">Редактировать</button>
                                        <button class="btn btn-danger">Деактивировать</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Справочники -->
                <div id="dictionaries" class="view">
                    <div class="page-title">Справочники</div>
                    
                    <div class="row">
                        <div class="col-2">
                            <div class="card">
                                <h3>Административные</h3>
                                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Области</button>
                                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Районы</button>
                                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Населенные пункты</button>
                            </div>
                        </div>
                        <div class="col-2">
                            <div class="card">
                                <h3>Медицинские</h3>
                                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Типы ампутации</button>
                                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Диагнозы</button>
                                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Типы устройств</button>
                            </div>
                        </div>
                        <div class="col-2">
                            <div class="card">
                                <h3>Технические</h3>
                                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Материалы</button>
                                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Работы</button>
                                <button class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">Сотрудники</button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Уведомления -->
    <div id="notification" class="notification"></div>
    
    <script>
        // Глобальные переменные
        let currentUser = null;
        let sessionTimeout = null;
        
        // API базовый URL
        const API_BASE = 'http://localhost:8000/api';
        
        // Функции уведомлений
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Функции аутентификации
        async function login(username, password) {
            try {
                const response = await fetch(`${API_BASE}/auth/login/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    currentUser = data.user;
                    showMainApp();
                    startSessionTimer(data.session_timeout);
                    showNotification('Успешный вход в систему');
                } else {
                    showNotification(data.error || 'Ошибка входа', 'error');
                }
            } catch (error) {
                showNotification('Ошибка соединения с сервером', 'error');
            }
        }
        
        async function logout() {
            try {
                await fetch(`${API_BASE}/auth/logout/`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                showLoginScreen();
                showNotification('Выход из системы выполнен');
            } catch (error) {
                showNotification('Ошибка при выходе', 'error');
            }
        }
        
        function showLoginScreen() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('main-app').style.display = 'none';
            currentUser = null;
            if (sessionTimeout) {
                clearTimeout(sessionTimeout);
                sessionTimeout = null;
            }
        }
        
        function showMainApp() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'grid';
            
            if (currentUser) {
                document.getElementById('user-info').textContent = 
                    `${currentUser.first_name} ${currentUser.last_name}`;
            }
        }
        
        function startSessionTimer(timeoutMinutes) {
            if (sessionTimeout) {
                clearTimeout(sessionTimeout);
            }
            
            sessionTimeout = setTimeout(() => {
                showNotification('Сессия истекла. Пожалуйста, войдите снова.', 'warning');
                showLoginScreen();
            }, timeoutMinutes * 60 * 1000);
        }
        
        // Функции навигации
        function showView(viewId) {
            // Скрыть все представления
            const views = document.querySelectorAll('.view');
            views.forEach(view => view.classList.remove('active'));
            
            // Показать выбранное представление
            const targetView = document.getElementById(viewId);
            if (targetView) {
                targetView.classList.add('active');
            }
            
            // Обновить активный пункт меню
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            
            // Обновить хлебные крошки
            const breadcrumb = document.getElementById('breadcrumb');
            const titles = {
                'dashboard': '/ Главная',
                'cart-list': '/ Картотека пациентов',
                'order-list': '/ Управление заказами',
                'medical-dept': '/ Медицинский отдел',
                'warehouse': '/ Склад',
                'reports': '/ Отчетность',
                'users': '/ Пользователи',
                'employees': '/ Сотрудники',
                'dictionaries': '/ Справочники'
            };
            
            if (titles[viewId]) {
                breadcrumb.textContent = titles[viewId];
            }
        }
        
        // Функции отчетов
        function generateReport(type) {
            showNotification(`Генерация отчета "${type}"...`, 'success');
            // Здесь можно добавить логику генерации отчетов
        }
        
        // Обработчики событий
        document.addEventListener('DOMContentLoaded', function() {
            // Обработчик формы входа
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                login(username, password);
            });
            
            // Обработчики для навигации
            const navItems = document.querySelectorAll('.nav-item[data-view]');
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const viewId = this.getAttribute('data-view');
                    showView(viewId);
                });
            });
            
            // Проверка сессии при загрузке
            checkSession();
        });
        
        // Проверка сессии
        async function checkSession() {
            try {
                const response = await fetch(`${API_BASE}/auth/check-session/`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (response.ok && data.valid) {
                    // Сессия валидна, показать главное приложение
                    showMainApp();
                    startSessionTimer(data.timeout);
                } else {
                    // Сессия невалидна, показать экран входа
                    showLoginScreen();
                }
            } catch (error) {
                // Ошибка соединения, показать экран входа
                showLoginScreen();
            }
        }
        
        // Загрузка данных при инициализации
        async function loadDashboardData() {
            try {
                // Здесь можно загрузить данные для главной страницы
                // const response = await fetch(`${API_BASE}/dashboard/`);
                // const data = await response.json();
                // Обновить статистику
            } catch (error) {
                console.error('Ошибка загрузки данных:', error);
            }
        }
    </script>
</body>
</html>
